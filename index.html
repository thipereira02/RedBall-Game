<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Red Ball Game</title>

    <style>
      body {
        background: #ccc;
        margin: 0;
      }

      canvas {
        cursor: none;
      }
    </style>
  </head>

  <body>
    <canvas
      id="canvas"
      onmousemove="onMouseMove(event)"
      onclick="startGame()"
    ></canvas>

    <script>
      const screenWidth = window.innerWidth;
      const screenHeight = window.innerHeight;

      const canvas = document.querySelector("#canvas");
      canvas.width = screenWidth;
      canvas.height = screenHeight;
      const context = canvas.getContext("2d");

      let intervalId;
      let scoreIntervalId;
      let highestScore = 0;

      let player = {
        x: screenWidth / 2,
        y: screenHeight / 2,
        radius: 100,
        color: "red",
        score: 0
      };

      let enemies = [];
      let timeToInsertEnemy = 0;

      function onMouseMove(event) {
        player.x = event.clientX;
        player.y = event.clientY;
      }

      function drawCircle(x, y, radius, color) {
        context.beginPath();
        context.fillStyle = color;
        context.arc(x, y, radius, 0, 2 * Math.PI);
        context.fill();
      }

      function clearScreen() {
        context.clearRect(0, 0, canvas.width, canvas.height);
      }

      function drawPlayer() {
        drawCircle(player.x, player.y, player.radius, player.color);
      }

      function drawEnemy(enemy) {
        drawCircle(enemy.x, enemy.y, enemy.radius, enemy.color);
      }

      function totalEnemies() {
        if (timeToInsertEnemy>100){
          const condition = Math.random();
          if (condition > 0.5) {
            addAnotherEnemy();
          } 
          timeToInsertEnemy = 0;
        } else timeToInsertEnemy++;
      }

      function addAnotherEnemy() {
        enemies.push({
          x: 0,
          y: 0,
          radius: 30,
          color: "blue",
          speedX: 10,
          speedY: 10,
        });
      }

      function moveEnemy(enemy) {
        enemy.x += enemy.speedX;
        enemy.y += enemy.speedY;
      }

      function checkEnemyCollision(enemy) {
        const distance = Math.sqrt(
          (player.x - enemy.x) ** 2 + (player.y - enemy.y) ** 2
        );

        return distance < player.radius + enemy.radius;
      }

      function bounceEnemyOnEdge(enemy) {
        if (enemy.x < 0 || enemy.x > screenWidth) {
          enemy.speedX *= -1;
        }

        if (enemy.y < 0 || enemy.y > screenHeight) {
          enemy.speedY *= -1;
        }
      }

      function increaseEnemySpeed(enemy) {
        enemy.speedX *= 1.001;
        enemy.speedY *= 1.001;
      }

      function endGame() {
        alert(`Que pena, você perdeu! Sua pontuação foi ${player.score}`);
        if (player.score >= highestScore){
          highestScore = player.score;
          alert(`Sua pontuação de ${player.score} é agora o recorde atual do jogo!`)
        }
        clearInterval(intervalId);
      }

      function startGame() {
        player.x = screenWidth / 2;
        player.y = screenHeight / 2;
        player.score = 0;

        enemies = [{
          x: 0,
          y: 0,
          radius: 30,
          color: "blue",
          speedX: 10,
          speedY: 10,
        }]

        clearInterval(intervalId);
        intervalId = setInterval(gameLoop, 1000 / 60);
        clearInterval(scoreIntervalId);
        scoreIntervalId = setInterval(() => player.score++, 1000);
      }

      
      function gameLoop() {
        clearScreen();
        totalEnemies();

        for (let i=0; i<enemies.length; i++) {
          const enemy = enemies[i];

          moveEnemy(enemy);

          if (checkEnemyCollision(enemy)) {
            endGame();
          }

          bounceEnemyOnEdge(enemy);
          increaseEnemySpeed(enemy);

          drawEnemy(enemy);
        };

        drawPlayer();
      }

      startGame();
    </script>
  </body>
</html>
